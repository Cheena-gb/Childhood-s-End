# Ver-1.0修正品 ビルドガイド  
本キーボードに特殊な機能・構造は特にありません。  
自作に慣れた方であれば、よしなにしていただければ問題なく機能します。  
スペーサーの組み方だけ順序がありますのでご注意ください。
<details><summary>組み立て順序</summary>バックパネルにネジ(7mm)を通し、スペーサー(2mm)で固定。基板を重ねてスペーサー(3.5mm)で固定。スイッチプレートを重ねてネジ(3mm)で固定。キーキャップをはめても見える場所(左手小指側上、傾斜部右上、傾斜部左上)のみトラスネジ3mmを使用します。</details>

## 作業前の準備
### 同梱品
 - 基板  
   1枚  
   「Childhood's End 幼年期の終り」と、バージョン情報が書き込まれた面が裏側となり、ほぼすべての作業はこちらの面に行います。  
    本ビルドガイド内で表裏と同時に左右を指定している場合、斜めに切断された辺が手前側となります。
 - スイッチプレート  
   1枚  
   星のマークのある面は裏側(組み立て後は内側)となります。
 - バックプレート  
   1枚  
   文字の書かれた面が表側(組み立て後は外側)となります。  
 - ゴム足  
   小4個大2個、合計6枚必要です。
 - ネジ  
   M2x12が10本入っています。
 - スペーサー  
   M2x3.5、M2x2.0が10個ずつ入っています。
 - ナット
   M2 1種が10個入っています。
 - 作業用ピンヘッダ
 - Waveshare RP2040-Zero  
   1個

### 必要なもの
 - Cherry MX互換キースイッチ  
   72個
 - MX軸キーキャップ  
   1セット JIS配列推奨  
   ※「キーキャップの選定」参照
 - MXキーソケット  
   72個 Kailh製のものを想定しています。
 - ダイオード  
   70個 1N4148シリーズ 表面実装、リードどちらを使用しても構いません。
 - MX用 2Uスタビライザー  
   3個　PCBマウントタイプ

### オプションパーツ類
 - LED SK6812MINI-E  
   71個
 - コンスルー  
   LEDを実装する際は、通電確認に使うと楽です。実装に使用するわけではありません。
   
### 必須工具類
 - はんだ作業関連品一式
 - USB TypeC通信用ケーブル
### 推奨工具類
 - キープラー
 - 油性マーカー(黒)
 - マスキングテープ
### 必要ファイルのダウンロード
 - childhood_s_end_vial-****.uf2
 - [Vial](https://get.vial.today/)
  
## キーキャップの選定
以下の条件を満たすJIS配列用のセットであれば主要なキーをカバーできます。  
 - 65%以上のセット  
 - JIS配列対応
100%のキットであればほぼ完璧にカバー可能ですが、最下段のキー幅によっては個別購入が必要になります。  
なお、現行品では1.5uおよびStepped形状のCaps Lockは使用不可能です。1.75uのものを使用してください。

最下段の構成は以下の通りです。合わない場合は個別に購入してください。
 - 1.25U Ctrl
 - 1.25U Win
 - 1.25U Alt
 - 1U 無変換
 - 2.25U Space
 - 1.75U Space
 - 1.25U 変換
 - 1.25U かな
 - 1.25U Alt
 - 1.25U Menu
 - 1.25U Ctrl
    
単品購入が必要だったり、移植する必要がある可能性の高いキーは以下の通りです。
 - 右ShiftおよびFn  
   1U @R2が必要です。同列のテンキーや矢印キー上を使用するか、ブランクを購入してください。  
 - Space  
   左側に2.25U @R1、右側に1.75U @R1を使用します。双方とも左右のShiftを移植することでぴったり合わせられます。  
 - 左Shift  
   2Uキーキャップを使用します。2U Shiftがない場合はテンキーの0を移植します。
  
その他のキーも足りない場合は適宜単品購入して合わせます。

[具体的なキー幅はKLEでも確認できます。](http://www.keyboard-layout-editor.com/##@@_y:2&x:2%3B&=%0AEsc%0A1&_x:0.5%3B&=%0AIns%0A2&=%0APrint%0A3&=%0AScLk%0A4&=%0APause%0A5&_x:5.75%3B&=%0A%2F=-%0A59&=%0A~%5E%0A64&=%0A%7C%5C%0A69&=%0ABS%0A72%3B&@_x:12.75%3B&=%0AP%0A55&=%0A%60%2F@%0A60&=%0A%7B%5B%0A65&_x:0.25&w:1.25&h:2&w2:1.5&h2:1&x2:-0.25%3B&=%0AEnter%0A70%0A%0A%0A%0A%0A%0A%0AISO%3B&@_y:-0.75&x:2%3B&=%0A%E5%8D%8A%2F%2F%E5%85%A8%0A6&=%0A1%0A11&=%0A2%0A16&=%0A3%0A21&=%0A4%0A26&=%0A5%0A31%3B&@_y:-0.25&x:13%3B&=%0A%2F%3B+%0A56&=%0A%2F:%0A61&=%0A%7D%5D%0A66%3B&@_y:-0.75&x:2&w:1.5%3B&=%0ATab%0A7%0A%0A%0A%0A%0A%0A%0A1.5&=%0AQ%0A12&=%0AW%0A17&=%0AE%0A22&=%0AR%0A27&=%0AT%0A32%3B&@_y:-0.25&x:13.25%3B&=%0A%3F%2F%2F%0A57&=%0A%2F_%5C%0A62&=%0AShiftR%0A67&=%0AFn%0A71%3B&@_y:-0.75&x:2&w:1.5&w2:1.75&l:true%3B&=%0ACaps%20Lock%0A8%0A%0A%0A%0A%0A%0A%0A1.75%20Step&_x:0.25%3B&=%0AA%0A13&=%0AS%0A18&=%0AD%0A23&=%0AF%0A28%0A%0A%0A%0A%0A%0A%0A%0A%2F_&=%0AG%0A33%3B&@_y:-0.25&x:13.5&w:1.25%3B&=%0AAltR%0A58%0A%0A%0A%0A%0A%0A%0A1.25&_w:1.25%3B&=%0AMenu%0A63%0A%0A%0A%0A%0A%0A%0A1.25&_w:1.25%3B&=%0ACtrlR%0A68%0A%0A%0A%0A%0A%0A%0A1.25%3B&@_y:-0.75&x:2&w:2%3B&=%0AShiftL%0A9%0A%0A%0A%0A%0A%0A%0A2&=%0AZ%0A14&=%0AX%0A19&=%0AC%0A24&=%0AV%0A29&=%0AB%0A34%3B&@_x:2&w:1.25%3B&=%0ACtrlL%0A10%0A%0A%0A%0A%0A%0A%0A1.25&_w:1.25%3B&=%0AWin%0A15%0A%0A%0A%0A%0A%0A%0A1.25&_w:1.25%3B&=%0AAltL%0A20%0A%0A%0A%0A%0A%0A%0A1.25&=%0A%E7%84%A1%E5%A4%89%E6%8F%9B%0A25&_w:2.25%3B&=%0A%0A30%0A%0A%0A%0A%0A%0A%0A2.25%3B&@_rx:12&ry:4.75&y:-2.75&x:0.25%3B&=%0A0%0A54%3B&@_r:-14.4&y:-0.75&x:-3.5%3B&=%0A6%0A35&=%0A7%0A40&=%0A8%0A44&=%0A9%0A49%3B&@_x:-3.25%3B&=%0AY%0A36&=%0AU%0A41&=%0AI%0A45&=%0AO%0A50%3B&@_x:-3.25%3B&=%0AH%0A37&=%0AJ%0A42%0A%0A%0A%0A%0A%0A%0A%0A%2F_&=%0AK%0A46&=%0AL%0A51%3B&@_x:-3.25%3B&=%0AN%0A38&=%0AM%0A43&=%0A%3C,%0A47&=%0A%3E.%0A52%3B&@_x:-3.5&w:1.75%3B&=%0A%0A39%0A%0A%0A%0A%0A%0A%0A1.75&_w:1.25%3B&=%0A%E5%A4%89%E6%8F%9B%0A48%0A%0A%0A%0A%0A%0A%0A1.25&_w:1.25%3B&=%0A%E3%82%AB%E3%81%B2%E3%83%AD%0A53%0A%0A%0A%0A%0A%0A%0A1.25)

## ファイルの確認
ファイル名末尾の **** の部分はバージョン情報です。基板のバージョンとファームウェアのバージョンには関連がありませんので、Ver.BETAを除いては特別な理由がない限り最新のものを使用してください。  
全て本リポジトリ内の/Firm/Ver-****/以下で入手できます。
### childhood_s_end_vial-****.uf2
キーボードを制御するためのファームウェアです。
**！！！.hexファイルはPro Micro用なので使用できません！！！**  
### Vial
[Vial公式](https://get.vial.today/)からダウンロードできる、リアルタイムでキーボードの設定を変更できるソフトウェアです。  
日本語配列への表示変更が可能なダウンロード版をおすすめしますが、Web版でも問題なく使用できます。  

## RP2040-Zeroの作業
### 動作確認
本バージョンに同梱のRP2040-Zeroはファームウェアを書き込み済みで提供しています。  
PCに接続してHIDデバイスとして認識されていること、Vialに繋いでキーマップが表示されることを確認できたら動作確認は終了です。

## はんだ前の作業
### 実装済み部分の確認
D10、D15、L63は配線の交雑が発見されたため手直しの上で提供しています。それぞれのパーツとジャンパー線は取り外さないでください。
D73は一般整流用ダイオードに交換されています。こちらも取り外さずに使用してください。

### 基板端の処理(任意)
基板の端(断面)を油性マーカーで塗ると綺麗に見えます。

## 部品のはんだづけ
ここから先は大量のパーツをはんだづけすることになります。  
途中で休憩もできますが、一度にやってしまうのが楽でしょう。

### LEDと周辺のはんだづけ(任意)
基板をウラから見て、角が欠けているパッドがGNDとなり、LED側の足の角が欠けている部分を合わせると正しい方向になります。  
発光面は基板オモテ側を向くようになります。丸い透明な樹脂がはまっている面が発光面です。    
<details><summary>LEDが正しくはんだづけできているか不安…</summary>コンスルーを使用し、基板とMCUを接続してみてください。問題なくはんだづけできれていれば、通電すると赤色に光るはずです。この状態でVialを起動し、Backlightingのタブから色やアニメーションを切り替えましょう。問題なく接続できているなら、アニメーションがなめらかに切り替わりますが、接続が不安定だと、その部分から先のLEDは不安定になります。</details>

### RP2040-Zeroのはんだづけ
RP2040を基板の裏側に載せ、端子のある面が表側に向くようにします。  
この状態で付属のピンヘッダやコンスルーを突き刺し、RP2040が動かないようにして、ピンヘッダを刺している場所以外の端面スルーホールをはんだづけしていきます。  
ピンヘッダにははんだづけを行わず、RP2040が軽く固定できた時点で抜いて、残りの端面スルーホールもはんだづけしてください。  

<details><summary>実際に使っているピンはどれ？</summary>マトリクススキャンはGP0～7、14、15、26～28、LED DOUTにGP29、LED用動力線の5V0、GNDです。</details>  
LEDを実装している場合、MCUに通電すれば赤色に発光するはずです。

### トラブルシューティング(1)
<details><summary>LEDがすべて光らない</summary>D73、L1、5V0、GND、GP29は問題なくはんだ付けできていますか？ケーブルは断線していませんか？</details>  
<details><summary>LEDが途中から光らない</summary>光らないLED自体のはんだづけと、光らないLEDの直前のLEDのはんだを確認してください。</details>  
<details><summary>それ以外の問題</summary>製作者に連絡してください。</details>
  
### ダイオードのはんだづけ
1N4148シリーズの使用を想定しています。**配線最適化のため、向きを統一していません**  
シルクスクリーンとダイオードの向きを揃えてはんだづけしてください。矢印の向く方向にダイオードの線が来ます。  
  
ダイオードのはんだづけに不安がある場合はここで導通確認を行います。  
VialのMatrix Testerを使用し、スイッチソケットのパッドにワイヤーやピンセットを当てて反応を確認してください。

### スイッチソケットのはんだづけ
シルクスクリーンとソケットの向きを揃えてはんだづけしてください。  
あまり大量にはんだを流すと端子部だけでなくソケット部にまで流れ込み、押し込みが硬くなったり、最悪の場合は端子がヤニでコーティングされて導通しなくなってしまうので注意してください。  
  

## 部品の取付け
### スタビライザーの静音化(任意)  
スタビライザーを分解して摺動部とワイヤーの端をたっぷりのグリスでコーティングします。  
スタビライザーの足元(穴と穴のあいだ)に静音パッドを貼ります。ない場合はマスキングテープや不織布テープを切って貼ります。  
テープの枚数は基板との隙間によりけり。多すぎると固定用の爪が噛まなくなるので適度にゲタを履かせましょう。

### スタビライザーの取付け 
ワイヤーが露出する部分は基板上に線で表示されています。  

### 導通確認
Matrix Testerを使用し、以下の方法のいずれかで基板の導通を確認します。
- スイッチをはめ、押してみて反応を見る。
- はんだ付けしたソケットの脚にピンセットやワイヤーをあてて導通させる。  
  
すべてのキーが間違いなく反応している状態であれば問題ありません。  
そうでない場合、トラブルシューティング(2)を確認して対応してください。

### トラブルシューティング(2)
<details><summary>キーが反応しない・別のキーが反応する(1個単位)</summary>ダイオードの方向、ソケットのはんだを確認してください。スイッチ自体の導通も見ましょう。</details>  
<details><summary>行・列単位でキーが反応しない</summary>RP2040のはんだ不良を疑います。ピンとパッドが問題なく接続されていること、周辺のパッドと短絡していないことを確認してください。</details>  
<details><summary>それ以外の問題</summary>製作者に連絡してください。</details>

### 組み立て  
まずスイッチプレートの表からネジを刺し、裏から3.5mmスペーサーで固定していきます。  
この際、SW1の右下、SW31とSW35の間、SW49とSW54の間には頭の大きいネジを使用します。  
全て固定したら、スイッチプレートを裏返し、ネジを上向きに露出させます。  
この状態で基板を重ね、2mmスペーサー、バックプレートを重ねたら、最後にすべてのネジをナットで留めていきます。

### ゴム足の取付け
バックプレートにゴム足を取り付けます。  
左側は文字が避けるようになっているので、位置を合わせて貼りつけてください。  
右側は文字の高さを元に左と合わせるか、定規などを使用して位置を合わせます。  
大小交えて傾斜させることもできます。

### スイッチの取付け
スイッチプレート側からすべてのスイッチを差し込みます。  
最後にもう一度Matrix Testerを起動し、すべてのスイッチが機能していることを確認します。  

### キーキャップの取付け
好みのキーキャップを取り付けます。

# マッピングガイド
キーマップの書き換えにはVialまたはReMap for QMK Firmware 0.18.17 or lowerを使用します。どちらも日本語配列にも対応しているため使いやすいと思います。  

## 初期状態
デフォルトで設定されているのはJIS配列を踏襲した配置となっており、通常のJISキーボードからの移行でも違和感なく使用できるはずです。  

Fnキーを押したときの挙動はレイヤーとして扱っています。初期状態では1から^までのキーにF1からF12を割り振り、さらにBackspaceにDeleteを設定している状態です。  
左上のエリア、Esc以外の4キーは初期状態では空となっています。LEDの制御やマクロなどに使用してください。  

## 書き換え
キーボードをPCに接続し、Vialを起動し、表示されたキーから変更したいものを選ぶ→画面下のリストからキーコードを選ぶ  
という手順で書き換えが可能です。  
詳細な使用方法はVialの公式ドキュメントなどを参照してください。
